
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Trading framework for Betfair API-NG.">
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-7.3.6">
    
    
      
        <title>QuickStart - flumine</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.a57b2b03.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.3f5d1f46.min.css">
        
          
          
          <meta name="theme-color" content="#546d78">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="blue-grey" data-md-color-accent="indigo">
  
    
    <script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#quickstart" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

  

<header class="md-header md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="flumine" class="md-header__button md-logo" aria-label="flumine" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            flumine
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              QuickStart
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/liampauling/flumine" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    liampauling/flumine
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href=".." class="md-tabs__link">
      Introduction
    </a>
  </li>

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="./" class="md-tabs__link md-tabs__link--active">
        Getting started
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../strategies/" class="md-tabs__link">
        Advanced
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="flumine" class="md-nav__button md-logo" aria-label="flumine" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    flumine
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/liampauling/flumine" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    liampauling/flumine
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Introduction
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Getting started
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Getting started" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Getting started
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          QuickStart
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        QuickStart
      </a>
      
        


<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#live" class="md-nav__link">
    Live
  </a>
  
    <nav class="md-nav" aria-label="Live">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#order-placement" class="md-nav__link">
    Order placement
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stream-class" class="md-nav__link">
    Stream class
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#paper-trading" class="md-nav__link">
    Paper Trading
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#backtesting" class="md-nav__link">
    Backtesting
  </a>
  
    <nav class="md-nav" aria-label="Backtesting">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#listener-kwargs" class="md-nav__link">
    Listener kwargs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#event-processing" class="md-nav__link">
    Event Processing
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#market-filter" class="md-nav__link">
    Market Filter
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#simulation" class="md-nav__link">
    Simulation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../help/" class="md-nav__link">
        Help
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Advanced
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Advanced" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Advanced
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../strategies/" class="md-nav__link">
        Strategies
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../trades/" class="md-nav__link">
        Trades / Orders
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../markets/" class="md-nav__link">
        Markets
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../controls/" class="md-nav__link">
        Controls
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../workers/" class="md-nav__link">
        Workers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../advanced/" class="md-nav__link">
        Advanced Usage
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/" class="md-nav__link">
        Architecture
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#live" class="md-nav__link">
    Live
  </a>
  
    <nav class="md-nav" aria-label="Live">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#order-placement" class="md-nav__link">
    Order placement
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stream-class" class="md-nav__link">
    Stream class
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#paper-trading" class="md-nav__link">
    Paper Trading
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#backtesting" class="md-nav__link">
    Backtesting
  </a>
  
    <nav class="md-nav" aria-label="Backtesting">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#listener-kwargs" class="md-nav__link">
    Listener kwargs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#event-processing" class="md-nav__link">
    Event Processing
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#market-filter" class="md-nav__link">
    Market Filter
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#simulation" class="md-nav__link">
    Simulation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="quickstart">QuickStart</h1>
<h2 id="live">Live</h2>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>flumine uses <code>betfairlightweight</code> for communicating with the Betfair API, please see <a href="https://liampauling.github.io/betfair/">docs</a> for how to use/setup before proceeding.</p>
</div>
<p>First, start by importing flumine/bflw and creating a trading and framework client:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">betfairlightweight</span>
<span class="kn">from</span> <span class="nn">flumine</span> <span class="kn">import</span> <span class="n">Flumine</span><span class="p">,</span> <span class="n">clients</span>

<span class="n">trading</span> <span class="o">=</span> <span class="n">betfairlightweight</span><span class="o">.</span><span class="n">APIClient</span><span class="p">(</span><span class="s2">&quot;username&quot;</span><span class="p">)</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">clients</span><span class="o">.</span><span class="n">BetfairClient</span><span class="p">(</span><span class="n">trading</span><span class="p">)</span>

<span class="n">framework</span> <span class="o">=</span> <span class="n">Flumine</span><span class="p">(</span><span class="n">client</span><span class="o">=</span><span class="n">client</span><span class="p">)</span>
</code></pre></div>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>flumine will handle login, logout and keep alive whilst the framework is running using the <code>keep_alive</code> worker.</p>
</div>
<p>A strategy can now be created by using the BaseStrategy class:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">flumine</span> <span class="kn">import</span> <span class="n">BaseStrategy</span>


<span class="k">class</span> <span class="nc">ExampleStrategy</span><span class="p">(</span><span class="n">BaseStrategy</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># subscribe to streams</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;starting strategy &#39;ExampleStrategy&#39;&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">check_market_book</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">market</span><span class="p">,</span> <span class="n">market_book</span><span class="p">):</span>
        <span class="c1"># process_market_book only executed if this returns True</span>
        <span class="k">if</span> <span class="n">market_book</span><span class="o">.</span><span class="n">status</span> <span class="o">!=</span> <span class="s2">&quot;CLOSED&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">process_market_book</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">market</span><span class="p">,</span> <span class="n">market_book</span><span class="p">):</span>
        <span class="c1"># process marketBook object</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">market_book</span><span class="o">.</span><span class="n">status</span><span class="p">)</span>
</code></pre></div>

<p>This strategy can now be initiated with the market and data filter before being added to the framework:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">betfairlightweight.filters</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">streaming_market_filter</span><span class="p">,</span> 
    <span class="n">streaming_market_data_filter</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">strategy</span> <span class="o">=</span> <span class="n">ExampleStrategy</span><span class="p">(</span>
    <span class="n">market_filter</span><span class="o">=</span><span class="n">streaming_market_filter</span><span class="p">(</span>
        <span class="n">event_type_ids</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;7&quot;</span><span class="p">],</span>
        <span class="n">country_codes</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;GB&quot;</span><span class="p">],</span>
        <span class="n">market_types</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;WIN&quot;</span><span class="p">],</span>
    <span class="p">),</span>
    <span class="n">market_data_filter</span><span class="o">=</span><span class="n">streaming_market_data_filter</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;EX_ALL_OFFERS&quot;</span><span class="p">])</span>
<span class="p">)</span>

<span class="n">framework</span><span class="o">.</span><span class="n">add_strategy</span><span class="p">(</span><span class="n">strategy</span><span class="p">)</span>
</code></pre></div>

<p>The framework can now be started:</p>
<div class="codehilite"><pre><span></span><code><span class="n">framework</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</code></pre></div>

<h3 id="order-placement">Order placement</h3>
<p>Orders can be placed as followed:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">flumine.order.trade</span> <span class="kn">import</span> <span class="n">Trade</span>
<span class="kn">from</span> <span class="nn">flumine.order.order</span> <span class="kn">import</span> <span class="n">LimitOrder</span>


<span class="k">class</span> <span class="nc">ExampleStrategy</span><span class="p">(</span><span class="n">BaseStrategy</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">process_market_book</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">market</span><span class="p">,</span> <span class="n">market_book</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">runner</span> <span class="ow">in</span> <span class="n">market_book</span><span class="o">.</span><span class="n">runners</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">runner</span><span class="o">.</span><span class="n">selection_id</span> <span class="o">==</span> <span class="mi">123</span><span class="p">:</span>
                <span class="n">trade</span> <span class="o">=</span> <span class="n">Trade</span><span class="p">(</span>
                    <span class="n">market_id</span><span class="o">=</span><span class="n">market_book</span><span class="o">.</span><span class="n">market_id</span><span class="p">,</span> 
                    <span class="n">selection_id</span><span class="o">=</span><span class="n">runner</span><span class="o">.</span><span class="n">selection_id</span><span class="p">,</span>
                    <span class="n">handicap</span><span class="o">=</span><span class="n">runner</span><span class="o">.</span><span class="n">handicap</span><span class="p">,</span>
                    <span class="n">strategy</span><span class="o">=</span><span class="bp">self</span>
                <span class="p">)</span>
                <span class="n">order</span> <span class="o">=</span> <span class="n">trade</span><span class="o">.</span><span class="n">create_order</span><span class="p">(</span>
                    <span class="n">side</span><span class="o">=</span><span class="s2">&quot;LAY&quot;</span><span class="p">,</span> 
                    <span class="n">order_type</span><span class="o">=</span><span class="n">LimitOrder</span><span class="p">(</span><span class="n">price</span><span class="o">=</span><span class="mf">1.01</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mf">2.00</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="n">market</span><span class="o">.</span><span class="n">place_order</span><span class="p">(</span><span class="n">order</span><span class="p">)</span>
</code></pre></div>

<p>This order will be validated through controls, stored in the blotter and sent straight to the execution thread pool for execution. It is also possible to batch orders into transactions as follows:</p>
<div class="codehilite"><pre><span></span><code><span class="k">with</span> <span class="n">market</span><span class="o">.</span><span class="n">transaction</span><span class="p">()</span> <span class="k">as</span> <span class="n">t</span><span class="p">:</span>
    <span class="n">market</span><span class="o">.</span><span class="n">place_order</span><span class="p">(</span><span class="n">order</span><span class="p">)</span>  <span class="c1"># executed immediately in separate transaction</span>
    <span class="n">t</span><span class="o">.</span><span class="n">place_order</span><span class="p">(</span><span class="n">order</span><span class="p">)</span>  <span class="c1"># executed on transaction __exit__</span>

<span class="k">with</span> <span class="n">market</span><span class="o">.</span><span class="n">transaction</span><span class="p">()</span> <span class="k">as</span> <span class="n">t</span><span class="p">:</span>
    <span class="n">t</span><span class="o">.</span><span class="n">place_order</span><span class="p">(</span><span class="n">order</span><span class="p">)</span>

    <span class="n">t</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>  <span class="c1"># above order executed</span>

    <span class="n">t</span><span class="o">.</span><span class="n">cancel_order</span><span class="p">(</span><span class="n">order</span><span class="p">)</span>
    <span class="n">t</span><span class="o">.</span><span class="n">place_order</span><span class="p">(</span><span class="n">order</span><span class="p">)</span>  <span class="c1"># both executed on transaction __exit__</span>
</code></pre></div>

<h3 id="stream-class">Stream class</h3>
<p>By default the stream class will be a MarketStream which provides a MarketBook python object, if collecting data this can be changed to a DataStream class however process_raw_data will be called and not process_market_book:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">flumine</span> <span class="kn">import</span> <span class="n">BaseStrategy</span>
<span class="kn">from</span> <span class="nn">flumine.streams.datastream</span> <span class="kn">import</span> <span class="n">DataStream</span>


<span class="k">class</span> <span class="nc">ExampleDataStrategy</span><span class="p">(</span><span class="n">BaseStrategy</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">process_raw_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">publish_time</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">publish_time</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

<span class="n">strategy</span> <span class="o">=</span> <span class="n">ExampleDataStrategy</span><span class="p">(</span>
    <span class="n">market_filter</span><span class="o">=</span><span class="n">streaming_market_filter</span><span class="p">(</span>
        <span class="n">event_type_ids</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;7&quot;</span><span class="p">],</span>
        <span class="n">country_codes</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;GB&quot;</span><span class="p">],</span>
        <span class="n">market_types</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;WIN&quot;</span><span class="p">],</span>
    <span class="p">),</span>
    <span class="n">stream_class</span><span class="o">=</span><span class="n">DataStream</span>
<span class="p">)</span>

<span class="n">flumine</span><span class="o">.</span><span class="n">add_strategy</span><span class="p">(</span><span class="n">strategy</span><span class="p">)</span>
</code></pre></div>

<p>The OrderDataStream class can be used to record order data as per market:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">flumine.streams.datastream</span> <span class="kn">import</span> <span class="n">OrderDataStream</span>

<span class="n">strategy</span> <span class="o">=</span> <span class="n">ExampleDataStrategy</span><span class="p">(</span>
    <span class="n">market_filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">stream_class</span><span class="o">=</span><span class="n">OrderDataStream</span>
<span class="p">)</span>

<span class="n">flumine</span><span class="o">.</span><span class="n">add_strategy</span><span class="p">(</span><span class="n">strategy</span><span class="p">)</span>
</code></pre></div>

<h2 id="paper-trading">Paper Trading</h2>
<p>Flumine can be used to paper trade strategies live using the following code:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">flumine</span> <span class="kn">import</span> <span class="n">clients</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">clients</span><span class="o">.</span><span class="n">BetfairClient</span><span class="p">(</span><span class="n">trading</span><span class="p">,</span> <span class="n">paper_trade</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>

<p>Market data will be recieved as per live but any orders will use Simulated execution and Simulated order polling to replicate live trading.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>This can be handy when testing strategies as the betfair website can be used to validate the market.</p>
</div>
<h2 id="backtesting">Backtesting</h2>
<p>Flumine can be used to backtest strategies using the following code:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">flumine</span> <span class="kn">import</span> <span class="n">FlumineBacktest</span><span class="p">,</span> <span class="n">clients</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">clients</span><span class="o">.</span><span class="n">BacktestClient</span><span class="p">()</span>
<span class="n">framework</span> <span class="o">=</span> <span class="n">FlumineBacktest</span><span class="p">(</span><span class="n">client</span><span class="o">=</span><span class="n">client</span><span class="p">)</span>

<span class="n">strategy</span> <span class="o">=</span> <span class="n">ExampleStrategy</span><span class="p">(</span>
    <span class="n">market_filter</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;markets&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;/tmp/marketdata/1.170212754&quot;</span><span class="p">]}</span>
<span class="p">)</span>
<span class="n">framework</span><span class="o">.</span><span class="n">add_strategy</span><span class="p">(</span><span class="n">strategy</span><span class="p">)</span>

<span class="n">framework</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</code></pre></div>

<p>Note the use of market filter to pass the file directories.</p>
<h3 id="listener-kwargs">Listener kwargs</h3>
<p>Sometimes a subset of the market lifetime is required, this can be optimised by limiting the number of updates to process resulting in faster backtesting:</p>
<div class="codehilite"><pre><span></span><code><span class="n">strategy</span> <span class="o">=</span> <span class="n">ExampleStrategy</span><span class="p">(</span>
    <span class="n">market_filter</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;markets&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;/tmp/marketdata/1.170212754&quot;</span><span class="p">],</span>
        <span class="s2">&quot;listener_kwargs&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;inplay&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;seconds_to_start&quot;</span><span class="p">:</span> <span class="mi">600</span><span class="p">},</span>
    <span class="p">}</span>
<span class="p">)</span>
</code></pre></div>

<ul>
<li>inplay: Filter inplay flag</li>
<li>seconds_to_start: Filter market seconds to start</li>
<li>calculate_market_tv: As per bflw listener arg</li>
<li>cumulative_runner_tv: As per bflw listener arg</li>
</ul>
<p>The extra kwargs above will limit processing to preplay in the final 10 minutes.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Multiple strategies and markets can be passed, flumine will pass the MarketBooks to the correct strategy via its subscription.</p>
</div>
<h3 id="event-processing">Event Processing</h3>
<p>It is also possible to process events with multiple markets such as win/place in racing or all football markets as per live by adding the following flag:</p>
<div class="codehilite"><pre><span></span><code><span class="n">strategy</span> <span class="o">=</span> <span class="n">ExampleStrategy</span><span class="p">(</span>
    <span class="n">market_filter</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;markets&quot;</span><span class="p">:</span> <span class="p">[</span><span class="o">..</span><span class="p">],</span> <span class="s2">&quot;event_processing&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
<span class="p">)</span>
</code></pre></div>

<p>The <code>Market</code> object contains a helper method for accessing other event linked markets:</p>
<div class="codehilite"><pre><span></span><code><span class="n">place_market</span> <span class="o">=</span> <span class="n">market</span><span class="o">.</span><span class="n">event</span><span class="p">[</span><span class="s2">&quot;PLACE&quot;</span><span class="p">]</span>
</code></pre></div>

<h3 id="market-filter">Market Filter</h3>
<p>When backtesting you can filter markets to be processed by using the <code>market_type</code> and <code>country_code</code> filter as per live:</p>
<div class="codehilite"><pre><span></span><code><span class="n">strategy</span> <span class="o">=</span> <span class="n">ExampleStrategy</span><span class="p">(</span>
    <span class="n">market_filter</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;markets&quot;</span><span class="p">:</span> <span class="p">[</span><span class="o">..</span><span class="p">],</span> <span class="s2">&quot;market_types&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;MATCH_ODDS&quot;</span><span class="p">],</span> <span class="s2">&quot;country_codes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;GB&quot;</span><span class="p">]}</span>
<span class="p">)</span>
</code></pre></div>

<h3 id="simulation">Simulation</h3>
<p>Backtesting uses the <code>SimulatedExecution</code> execution class and tries to accurately simulate matching with the following:</p>
<ul>
<li>Place/Cancel/Replace latency delay added</li>
<li>BetDelay added based on market state</li>
<li>Queue positioning based on liquidity available</li>
<li>Order lapse on market version change</li>
<li>Order lapse and reduction on runner removal</li>
<li>BSP</li>
</ul>
<p>Limitations #192:</p>
<ul>
<li>Queue cancellations</li>
<li>Double counting of liquidity</li>
<li>Currency fluctuations</li>
</ul>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href=".." class="md-footer__link md-footer__link--prev" aria-label="Previous: Introduction" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Introduction
            </div>
          </div>
        </a>
      
      
        
        <a href="../help/" class="md-footer__link md-footer__link--next" aria-label="Next: Help" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Help
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        
          Made with
          <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
            Material for MkDocs
          </a>
        
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "navigation.tabs.sticky"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.fcfe8b6d.min.js", "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.b1047164.min.js"></script>
      
    
  </body>
</html>